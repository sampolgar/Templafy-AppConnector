<!DOCTYPE html>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
    integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">

<head>
    <title>Templafy App Connector</title>
</head>

<body>
    <div class="container mt-5">
        <h1>Templafy App Connector</h1>
        <form class="row g-3" id="popUpURL">
            <div class="col-md-6">
                <label for="tenantName" class="form-label">Tenant name</label>
                <input type="text" class="form-control" id="tenantName" oninput="updateTenantName()">
                <small id="tenantNameHelp" class="form-text text-muted">Just the tenantname e.g.
                    https://tenantname.templafy.com</small>
            </div>
            <div class="col-md-12">
                <label for="features" class="form-label">Features and settings of the pop-up window</label>
                <input type="text" class="form-control" id="features" oninput="updateFeatures()">
            </div>
            <div class="col-md-12">
                <label for="configUrl" class="form-label">Config URL</label>
                <input type="text" class="form-control" id="configUrl" readonly>
                <small id="configUrlHelp" class="form-text text-muted">this URL is read only, generated from the Tenant
                    name and current site</small>
            </div>
            <div class="col-md-12">
                <label for="libraryNavLabel" class="form-label">Library navigation path</label>
                <input type="text" class="form-control" id="libraryNav" onclick="updateLibraryNav()">
                <small id="libraryNavHelp" class="form-text text-muted">Must start and end with /</small>
<<<<<<< HEAD
=======
            </div>
            <div class="col-md-12">
                <ul class="list-unstyled">
                    <li>By default, Templafy opens the root of the library pane e.g. when you navigate to
                        https://tenantname.templafy.com</li>
                    <li>For scenarios where you want to open the library pane at a specific folder or document, you can
                        specify the path to the folder in the library pane.</li>
                    <li></li>
                    <li><strong>Folder example:</strong></li>
                    <li>If you setup the app connector on a CRM that only makes templates from the CRM folder in the
                        library, you can specify Templafy to open on the CRM folder.</li>
                    <li>
                        <ul>
                            <li>navigate to the path in the library pane</li>
                            <li>copy the URL from the browser e.g.
                                https://samsandboxaus2.templafy.com/library/documents/Global/sales/crm</li>
                            <li>remove the https://tenantname.templafy.com</li>
                            <li>add navigation path: /library/documents/Global/sales/crm</li>
                        </ul>
                    </li>
                    <li></li>
                    <li><strong>Specific document example:</strong></li>
                    <li>If you want to open a specific document form, perhaps one you're sending JSON data into, you can
                        specify the path to the document.</li>
                    <li>
                        <ul>
                            <li>navigate to the path in the library pane</li>
                            <li>copy the URL from the browser e.g.
                                https://samsandboxaus2.templafy.com/library/documents/Global/sales/crm/_service-contract
                            </li>
                            <li>remove the https://tenantname.templafy.com</li>
                            <li>add navigation path: /library/documents/Global/sales/crm/_service-contract</li>
                        </ul>
                    </li>

                </ul>
>>>>>>> 4209e07a1864cc1f6f16f97bd95996d075261634
            </div>
            <div class="col-md-12">
                <label for="jsonContent" class="form-label">JSON Content - this will be sent to the document, must be
                    valid JSON</label>
                <textarea class="form-control" id="jsonContent" rows="21" oninput="auto_grow(this)"></textarea>
            </div>
            <div class="col-12">
                <button type="button" class="btn btn-primary" onclick="openTemplafy()">Open App Connector</button>
        </form>
    </div>
</body>

// Javascript function to open the Templafy pop-up
<script>
    function openTemplafy() {
        let tenantOrigin = new URL(path).origin;
        window.onmessage = (event) => {
<<<<<<< HEAD
            console.log("event" + JSON.stringify(event.data))
            //
            if (event.data.type == "ready") {
                console.log("event ready" + JSON.stringify(event.data))
                openedPopup.postMessage({
                    type: "content",
                    content: obj,
                },
                    tenantOrigin);
            }

            //
            if (event.data.type == "document") {
                window.addEventListener('message', console.log)
                console.log("event document" + JSON.stringify(event.data))
=======
            if (event.data.type == "ready") {
                openedPopup.postMessage({
                    type: "content",
                    content: document.getElementById("jsonContent").value,
                    url: path
                    // content: {
                    //     title: "Document Library",
                    //     url: path
                    // }
                },
                    tenantOrigin);
            }
            if (event.data.type == "document") {
>>>>>>> 4209e07a1864cc1f6f16f97bd95996d075261634
                var documentURL = event.data.documentUrl;
                openedPopup.close();
                window.location.href = documentURL;
            }
        };
<<<<<<< HEAD
        let openedPopup = window.open(path, "_blank", features);
=======
        var openedPopup = window.open(path, "_blank", features);
>>>>>>> 4209e07a1864cc1f6f16f97bd95996d075261634
    }


    //set defaults
    let tenantName = "samsandboxaus2";
    document.getElementById("tenantName").value = tenantName;

    let libraryNav = "/library/";
    document.getElementById("libraryNav").value = libraryNav;

    let features = "menubar=no,location=no,resizable=no,scrollbars=no,status=no,titlebar=no,toolbar=no,width=1500,height=1000";
    document.getElementById("features").value = features;

    let path = `https://${tenantName}.hive.templafy.com${libraryNav}?externalSystemType=genericAppConnector&origin=${window.location.origin}`;
    document.getElementById("configUrl").value = path;

    function updateTenantName() {
        tenantName = document.getElementById("tenantName").value;
        path = `https://${tenantName}.hive.templafy.com${libraryNav}?externalSystemType=genericAppConnector&origin=${window.location.origin}`;
        document.getElementById("configUrl").value = path;
    }

    function updateFeatures() {
        features = document.getElementById("features").value;
    }

    function updateLibraryNav() {
        libraryNav = document.getElementById("libraryNav").value;
        path = `https://${tenantName}.hive.templafy.com${libraryNav}?externalSystemType=genericAppConnector&origin=${window.location.origin}`;
        document.getElementById("configUrl").value = path;
    }

    let obj = {
        accountName: "Franks Fine Dining Restaurant",
        orderTotal: "$16.50",
        purchases: [
            {
                name: "Banana",
                price: "$1.50",
                image: "https://github.com/sampolgar/Templafy-AppConnector/blob/assets/banana.jpg"
            },
            {
                name: "Mango",
                price: "$2.00",
                image: "https://github.com/sampolgar/Templafy-AppConnector/blob/assets/mango.jpg"
            },
            {
                name: "Papaya",
                price: "$3.00",
                image: "https://github.com/sampolgar/Templafy-AppConnector/blob/assets/papaya.jpg"
            }
        ]
    }

    document.getElementById('jsonContent').value = prettyMyJson(obj);

    function prettyMyJson(uglyJson) {
        return JSON.stringify(uglyJson, undefined, 4);
    }

    function auto_grow(element) {
        element.style.height = "5px";
        element.style.height = (element.scrollHeight) + "px";
    }
</script>

</html>