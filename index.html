<!DOCTYPE html>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
    integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">

<head>
    <title>Templafy App Connector</title>
</head>

<body>
    <div class="container mt-5">
        <h1>Templafy App Connector</h1>
        <form class="row g-3" id="popUpURL">
            <div class="col-md-6">
                <label for="tenantName" class="form-label">Tenant name</label>
                <input type="text" class="form-control" id="tenantName" oninput="updateTenantName()">
                <small id="tenantNameHelp" class="form-text text-muted">Just the tenantname e.g.
                    https://<mark>tenantname</mark>.templafy.com</small>
            </div>
            <div class="col-md-12">
                <label for="features" class="form-label">Features and settings of the pop-up window</label>
                <input type="text" class="form-control" id="features" oninput="updateFeatures()">
            </div>
            <div class="col-md-12">
                <label for="configUrl" class="form-label">Config URL</label>
                <input type="text" class="form-control" id="configUrl" readonly>
                <small id="configUrlHelp" class="form-text text-muted">this URL is read only, generated from the Tenant
                    name and current site</small>
            </div>
            <div class="col-md-12">
                <label for="libraryNavLabel" class="form-label">Library navigation path</label>
                <input type="text" class="form-control" id="libraryNav" onclick="updateLibraryNav()">
            </div>
            <div class="col-md-12">
                <p>
                    hello world
                </p>
            </div>
            <div class="col-md-12">
                <label for="jsonContent" class="form-label">JSON Content - this will be sent to the document, must be
                    valid JSON</label>
                <textarea class="form-control" id="jsonContent" rows="25" oninput="auto_grow(this)"></textarea>
            </div>
            <div class="col-12">
                <button type="button" class="btn btn-primary" onclick="openTemplafy()">Open App Connector</button>
        </form>
    </div>
</body>

<script>
    function openTemplafy() {
        let tenantOrigin = new URL(path).origin;

        window.onmessage = (event) => {

            if (event.data.type == "ready") {

                openedPopup.postMessage({ type: "content", content: { title: "Document Library", url: path } }, tenantOrigin);

            }

            if (event.data.type == "document") {

                var documentURL = event.data.documentUrl;

                openedPopup.close();

                window.location.href = documentURL;

            }

        };

        var openedPopup = window.open(path, "_blank", features);

    }

    //
    let tenantName = "samsandboxaus2";
    document.getElementById("tenantName").value = tenantName;

    let path = `https://${tenantName}.hive.templafy.com/library/documents?externalSystemType=genericAppConnector&origin=${window.location.origin}`;
    document.getElementById("configUrl").value = path;

    function updateTenantName() {
        tenantName = document.getElementById("tenantName").value;
        path = `https://${tenantName}.hive.templafy.com/library/documents?externalSystemType=genericAppConnector&origin=${window.location.origin}`;
        document.getElementById("configUrl").value = path;
    }

    let features = "menubar=no,location=no,resizable=no,scrollbars=no,status=no,titlebar=no,toolbar=no,width=1500,height=1000";
    document.getElementById("features").value = features;

    function updateFeatures() {
        features = document.getElementById("features").value;
    }

    let libraryNav = "";
    function updateLibraryNav() {
        libraryNav = document.getElementById("libraryNav").value;
    }

    let obj = { "glossary": { "title": "example glossary", "GlossDiv": { "title": "S", "GlossList": { "GlossEntry": { "ID": "SGML", "SortAs": "SGML", "GlossTerm": "Standard Generalized Markup Language", "Acronym": "SGML", "Abbrev": "ISO 8879:1986", "GlossDef": { "para": "A meta-markup language, used to create markup languages such as DocBook.", "GlossSeeAlso": ["GML", "XML"] }, "GlossSee": "markup" } } } } }
    document.getElementById('jsonContent').value = prettyMyJson(obj);

    function prettyMyJson(uglyJson) {
        return JSON.stringify(uglyJson, undefined, 4);
    }

    function auto_grow(element) {
        element.style.height = "5px";
        element.style.height = (element.scrollHeight) + "px";
    }

</script>

</html>